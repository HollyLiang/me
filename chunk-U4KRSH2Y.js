import{a as x,b as I,d as S}from"./chunk-GUTZUICD.js";import{a as ee,b as te}from"./chunk-YWXZT3G3.js";import{C as K,D as Q,I as X,L as Y,a as N,j as U,k,l as R,m as D,o as V,q,r as $,u as z,v as B,w as G,x as H,y as W,z as J}from"./chunk-WCM3HR3F.js";import{$ as l,Ea as L,Ga as g,Hb as A,Lb as E,Pa as o,Qa as s,Ra as c,Rb as T,T as w,U as h,Va as j,W as P,Ya as v,Yb as Z,_b as M,aa as b,ac as _,da as O,ea as F,gb as m,s as y,sa as u,ta as a}from"./chunk-JXSNNN5X.js";var p=(()=>{let e=class e{constructor(t,i){this.http=t,this.userService=i,this.LINE_PROFILE_URL="https://api.line.me/v2/profile"}getApiClientId(){return this.http.get(`${x.serverUrl}Line/login/clientId`)}loginToken(t){let i={code:t,redirectUri:location.origin+"/auth/line/callback"};return this.http.post(`${x.serverUrl}Line/login/token`,i).pipe(y(n=>(this.tokenType=n.token_type,this.accessToken=n.access_token,this.userService.accessToken=this.accessToken,n)))}getProfile(){return this.http.get(this.LINE_PROFILE_URL,{headers:{Authorization:`${this.tokenType} ${this.accessToken}`}}).pipe(y(t=>(this.userService.userInfo={id:t.userId,name:t.displayName,imgUrl:t.pictureUrl},t)))}};e.\u0275fac=function(i){return new(i||e)(P(T),P(I))},e.\u0275prov=w({token:e,factory:e.\u0275fac});let r=e;return r})();var re=(()=>{let e=class e{constructor(t,i,n){this.router=t,this.route=i,this.lineService=n,this.initParams()}initParams(){let t=this.route.snapshot.queryParams;console.log(t),t?.code&&this.getAccessToken(t.code)}ngOnInit(){}getAccessToken(t){let i={code:t,redirectUri:""};this.lineService.loginToken(t).subscribe(n=>{this.lineService.getProfile().subscribe(d=>{this.router.navigate(["/"])})})}};e.\u0275fac=function(i){return new(i||e)(a(M),a(Z),a(p))},e.\u0275cmp=l({type:e,selectors:[["app-auth-line-signin-callback"]],decls:0,vars:0,template:function(i,n){},encapsulation:2});let r=e;return r})();var ne=(()=>{let e=class e{constructor(t){this.lineService=t,this.redirectUrl=location.origin+"/auth/line/callback"}ngOnInit(){}onLineLoginClick(){this.lineService.getApiClientId().subscribe(t=>{let n=`https://access.line.me/oauth2/v2.1/authorize?${["response_type=code",`client_id=${t}`,"state=123123","scope=profile%20openid	",`redirect_uri=${this.redirectUrl}`,"nonce  =09876xyz"].join("&")}`;window.open(n,"_self")})}};e.\u0275fac=function(i){return new(i||e)(a(p))},e.\u0275cmp=l({type:e,selectors:[["app-auth-line-login-btn"]],decls:1,vars:0,consts:[[1,"line-btn",3,"click"]],template:function(i,n){i&1&&(o(0,"div",0),v("click",function(){return n.onLineLoginClick()}),s())},styles:["[_nghost-%COMP%]{display:block}[_nghost-%COMP%]   .line-btn[_ngcontent-%COMP%]{width:142px;height:40px;cursor:pointer;background-image:url(/assets/img/line-btn/2x/20dp/btn_login_base.png)}[_nghost-%COMP%]   .line-btn[_ngcontent-%COMP%]:hover{background-image:url(/assets/img/line-btn/2x/20dp/btn_login_hover.png)}[_nghost-%COMP%]   .line-btn[_ngcontent-%COMP%]:active{background-image:url(/assets/img/line-btn/2x/20dp/btn_login_press.png)}"]});let r=e;return r})();function le(r,e){r&1&&(o(0,"mat-error")(1,"strong"),m(2,"Account or Password incorrected"),s()())}var oe=(()=>{let e=class e{constructor(t,i,n,d){this.fb=t,this.router=i,this.userService=n,this.authAPI=d;let C="";this.userService.rememberMe&&(C=this.userService.account),this.signInForm=this.fb.group({account:[C,[k.required]],password:["",[k.required]],rememberMe:[this.userService.rememberMe]})}ngOnInit(){}onFormSubmit(){if(this.errorMsg="",this.signInForm.valid){let t=this.signInForm.value,i=this.signInForm.value.rememberMe;this.userService.rememberMe=i,this.userService.account=i?t.account:"",this.authAPI.signIn(t.account,t.password).subscribe(n=>{console.log(n),this.router.navigate(["/"])},()=>{console.log("err"),this.errorMsg="AccountOrPasswordError"})}}};e.\u0275fac=function(i){return new(i||e)(a(B),a(M),a(I),a(S))},e.\u0275cmp=l({type:e,selectors:[["app-auth-signin"]],decls:32,vars:4,consts:[["form","ngForm"],[1,"bg-blur"],[1,"bg-cover"],[1,"container"],[1,"singin-container",3,"ngSubmit","formGroup"],[1,"singin-header"],[1,"col-12"],["matInput","","required","","placeholder","holly","formControlName","account"],[3,"control"],["matInput","","type","password","required","","placeholder","123456","formControlName","password"],["color","primary","formControlName","rememberMe",1,"example-margin"],[4,"ngIf"],[1,"col-10","offset-1","margin-top-2x"],["mat-raised-button","","color","primary","type","submit",1,"col-12"],[1,"padding-top-4x","d-flex","align-items-center","justify-content-center","flex-direct-col"],[1,"padding-bottom-4x",2,"width","100px"]],template:function(i,n){if(i&1){let d=j();c(0,"div",1)(1,"div",2),o(2,"div",3)(3,"form",4,0),v("ngSubmit",function(){return O(d),F(n.onFormSubmit())}),o(5,"h1",5),m(6,"Welcome"),s(),o(7,"section")(8,"mat-form-field",6)(9,"mat-label"),m(10,"Account"),s(),c(11,"input",7),o(12,"mat-error"),c(13,"app-form-error",8),s()()(),o(14,"section")(15,"mat-form-field",6)(16,"mat-label"),m(17,"Password"),s(),c(18,"input",9),o(19,"mat-error"),c(20,"app-form-error",8),s()()(),o(21,"section",6)(22,"mat-slide-toggle",10),m(23," Remember me "),s()(),o(24,"section",6),L(25,le,3,0,"mat-error",11),s(),o(26,"section",12)(27,"button",13),m(28,"Sign In"),s()(),o(29,"section",14),c(30,"mat-divider",15)(31,"app-auth-line-login-btn"),s()()()}i&2&&(u(3),g("formGroup",n.signInForm),u(10),g("control",n.signInForm.controls.account),u(7),g("control",n.signInForm.controls.password),u(5),g("ngIf",n.errorMsg))},dependencies:[A,V,U,R,D,z,q,$,N,X,K,W,J,Q,Y,ee,ne],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:block;overflow:hidden;position:relative}[_nghost-%COMP%]   .bg-blur[_ngcontent-%COMP%]{width:110%;height:110%;background-image:url(/assets/img/signin-bg.jpeg);background-size:100%;background-position:center;position:absolute;top:-5%;left:-5%;filter:blur(10px);z-index:-2}[_nghost-%COMP%]   .bg-cover[_ngcontent-%COMP%]{background-color:#e8e8e866;width:100%;height:100%;position:absolute;top:0;left:0;z-index:-1}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]{height:100%;display:flex;align-items:center;justify-content:center}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .singin-container[_ngcontent-%COMP%]{background-color:#e8e8e8b3;width:400px;border-radius:8px;box-shadow:0 0 12px 3px #2020204d;padding:16px}[_nghost-%COMP%]   .container[_ngcontent-%COMP%]   .singin-container[_ngcontent-%COMP%]   .singin-header[_ngcontent-%COMP%]{text-align:center}"]});let r=e;return r})();var pe=[{path:"signIn",component:oe},{path:"line/callback",component:re}],se=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=b({type:e}),e.\u0275inj=h({imports:[_.forChild(pe),_]});let r=e;return r})();var $e=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=b({type:e}),e.\u0275inj=h({providers:[S,p],imports:[E,G,H,se,te]});let r=e;return r})();export{$e as AuthModule};
